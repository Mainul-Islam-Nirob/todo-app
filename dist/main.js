(()=>{const e=(e,t,o,n)=>({title:e,description:t,dueDate:o,priority:n}),t=e=>({name:e,todos:[]}),o=[];let n=null;const d=()=>{const e=document.getElementById("project-list");e.innerHTML="",o.forEach(((t,l)=>{const a=document.createElement("div");a.classList.add("project");const i=document.createElement("span");i.classList.add("project-name"),i.textContent=t.name,i.addEventListener("click",(()=>{const e=document.querySelectorAll(".project-name");document.querySelectorAll(".nav-link").forEach((e=>{e.classList.remove("nav-active")})),e.forEach((e=>e.classList.remove("project-active"))),i.classList.add("project-active"),c(l)}));const m=document.createElement("div");m.classList.add("projectBtns");const E=document.createElement("i");E.classList.add("projectBtn","fa-solid","fa-pen-to-square"),E.onclick=()=>(e=>{n=e,document.getElementById("projectName").value=o[e].name,document.getElementById("projectModalTitle").textContent="Update Project",s("projectModal")})(l);const y=document.createElement("i");y.classList.add("projectBtn","fa-regular","fa-trash"),y.onclick=()=>(e=>{confirm("Are you sure you want to delete this project and all its todos?")&&(o.splice(e,1),u(),d(),c(null,"all"),p("show-all-todos"))})(l);const h=document.createElement("i");h.classList.add("projectBtn","fa-sharp","fa-solid","fa-plus"),h.onclick=()=>{r=l,s("todoModal")},m.appendChild(E),m.appendChild(y),m.appendChild(h),a.appendChild(i),a.appendChild(m),e.appendChild(a)}))};let l=null;const c=(e=null,t=null)=>{const n=document.getElementById("todo-list");n.innerHTML="";let d=[];"all"===t?d=o.flatMap(((e,t)=>e.todos.map(((o,n)=>({...o,projectName:e.name,projectIndex:t,todoIndex:n}))))):"important"===t?d=o.flatMap(((e,t)=>e.todos.filter((e=>"High"===e.priority)).map(((o,n)=>({...o,projectName:e.name,projectIndex:t,todoIndex:n}))))):null!==e&&o[e]&&(d=o[e].todos.map(((t,n)=>({...t,projectName:o[e].name,projectIndex:e,todoIndex:n})))),0!==d.length?d.forEach(((e,t)=>{const d=document.createElement("div");d.classList.add("todoItem");const a=document.createElement("div");a.classList.add("t-title"),a.textContent=e.title,d.appendChild(a);const p=document.createElement("div");p.classList.add("t-description"),p.textContent=e.description,d.appendChild(p);const E=document.createElement("div");E.classList.add("t-priority"),E.textContent=`Priority: ${e.priority}`,d.appendChild(E);const y=document.createElement("div");y.classList.add("t-dueDate"),y.textContent=`Due: ${e.dueDate}`,d.appendChild(y);const h=document.createElement("div");h.classList.add("projectName"),h.textContent=`Project: ${e.projectName}`,d.appendChild(h);const v=document.createElement("div");v.classList.add("edit-item");const g=document.createElement("span");g.classList.add("edit-btn"),g.textContent="Edit",g.onclick=()=>((e,t)=>{l=t;const n=o[e].todos[t];document.getElementById("title").value=n.title,document.getElementById("details").value=n.description,document.getElementById("date").value=n.dueDate,i=n.priority,r=e,m("Low"===i?"low-btn":"high-btn","High"===i?"low-btn":"high-btn"),document.getElementById("todoModalTitle").textContent="Update Task",s("todoModal")})(e.projectIndex,e.todoIndex),v.appendChild(g);const I=document.createElement("span");I.classList.add("edit-btn"),I.textContent="Delete",I.onclick=()=>((e,t)=>{o[e].todos.splice(t,1),c(null,"all"),u()})(e.projectIndex,e.todoIndex),v.appendChild(I),d.appendChild(v),n.appendChild(d)})):n.innerHTML="<p class='no-todo'>No todos found :(</p>"},a=()=>{document.getElementById("todo-form").reset(),document.getElementById("project-form").reset(),i="",l=null,n=null,document.querySelectorAll(".priority-btn .btn").forEach((e=>{e.classList.remove("selected")})),document.getElementById("todoModalTitle").textContent="New Task",document.getElementById("projectModalTitle").textContent="New Project"},s=e=>{const t=document.getElementById(e);t.style.display="block";const o=t.querySelector("input[autofocus]");o&&o.focus(),t.querySelector(".closeBtn").addEventListener("click",(()=>{t.style.display="none",a()}))};let i="";document.getElementById("low-btn").addEventListener("click",(()=>{i="Low",m("low-btn","high-btn")})),document.getElementById("high-btn").addEventListener("click",(()=>{i="High",m("high-btn","low-btn")}));let r=null;function m(e,t){const o=document.getElementById(e),n=document.getElementById(t);o&&o.classList.add("selected"),n&&n.classList.remove("selected")}const p=e=>{const t=document.querySelectorAll(".nav-link");document.querySelectorAll(".project-name").forEach((e=>{e.classList.remove("project-active")})),t.forEach((e=>{e.classList.remove("nav-active")}));const o=document.getElementById(e);o&&o.classList.add("nav-active")};document.getElementById("show-project-modal").addEventListener("click",(()=>s("projectModal"))),document.getElementById("todo-form").addEventListener("submit",(t=>{t.preventDefault();const n=document.getElementById("title").value,d=document.getElementById("details").value,s=document.getElementById("date").value;if(!i)return void alert("Please select a priority!");const p=i;if(null!==l){const t=r;o[t]?(o[t].todos[l]=e(n,d,s,p),c(t),l=null):alert("Error: Project not found.")}else{const t=e(n,d,s,p);((e,t)=>{o[e].todos.push(t),u(),c(e)})(r,t)}u(),document.getElementById("todoModal").style.display="none",m(),a()})),document.getElementById("project-form").addEventListener("submit",(e=>{e.preventDefault();const l=document.getElementById("projectName").value;null!==n?(o[n].name=l,d(),n=null):(e=>{const n=t(e);o.push(n),u(),d()})(l),u(),document.getElementById("projectModal").style.display="none",a()})),document.getElementById("show-all-todos").addEventListener("click",(()=>{c(null,"all"),p("show-all-todos")})),document.getElementById("importantNav").addEventListener("click",(()=>{c(null,"important"),p("importantNav")}));const u=()=>{localStorage.setItem("todoAppData",JSON.stringify(o))};document.addEventListener("DOMContentLoaded",(()=>{(()=>{const n=localStorage.getItem("todoAppData");n&&(JSON.parse(n).forEach((n=>{const d=t(n.name);n.todos.forEach((t=>{d.todos.push(e(t.title,t.description,t.dueDate,t.priority))})),o.push(d)})),d(),c(null,"all"),p("show-all-todos"))})()}))})();